<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Picos_mux_multififo (picos_mux.Picos_mux_multififo)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.4"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../';
let search_urls = ['../db.js','../../sherlodoc.js'];
</script><script src="../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../index.html">picos_mux</a> &#x00BB; Picos_mux_multififo</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Picos_mux_multififo</span></code></h1><p>Basic multi-threaded effects based <a href="../../picos/Picos/index.html"><code>Picos</code></a> compatible scheduler for OCaml 5.</p><p>This scheduler uses a queue per thread to implement a mostly FIFO scheduler. If a thread runs out of fibers to run, it will try to take a fiber from the queues of other threads, which means that fibers can move from one thread to another. This scheduler also gives priority to fibers woken up due to being canceled.</p><p>üêå Due to mostly FIFO scheduling this scheduler performs poorly on highly parallel workloads.</p><p>‚ÑπÔ∏è See <a href="../Picos_mux_fifo/index.html"><code>Picos_mux_fifo</code></a> for a single-threaded variation of this scheduler.</p><p>‚ÑπÔ∏è This scheduler implementation is mostly meant as an example and for use in testing libraries implemented in <a href="../../picos/Picos/index.html"><code>Picos</code></a>.</p><p>‚ö†Ô∏è This scheduler uses <a href="../../picos_io/Picos_io_select/index.html"><code>Picos_io_select</code></a> internally. If running multiple threads that each run this scheduler, <a href="../../picos_io/Picos_io_select/index.html#val-configure"><code>Picos_io_select.configure</code></a> must be called by the main thread before creating other threads.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Represents a shared context for fifo runners.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-context"><a href="#val-context" class="anchor"></a><code><span><span class="keyword">val</span> context : <span><span class="optlabel">?quota</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?fatal_exn_handler</span>:<span>(<span>exn <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>context ()</code> creates a new context for randomized runners. The context should be consumed by a call of <a href="#val-run" title="run"><code>run ~context ...</code></a>.</p><p>The optional <code>quota</code> argument defaults to <code>Int.max_int</code> and determines the number of effects a fiber is allowed to perform before it is forced to yield.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-runner_on_this_thread"><a href="#val-runner_on_this_thread" class="anchor"></a><code><span><span class="keyword">val</span> runner_on_this_thread : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>runner_on_this_thread context</code> starts a runner on the current thread to run fibers on the context. The runner returns when <a href="#val-run" title="run"><code>run ~context ...</code></a> returns.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_fiber"><a href="#val-run_fiber" class="anchor"></a><code><span><span class="keyword">val</span> run_fiber : <span><span class="optlabel">?context</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../picos/Picos/Fiber/index.html#type-t">Picos.Fiber.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="../../picos/Picos/Fiber/index.html#type-t">Picos.Fiber.t</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>run_fiber fiber main</code> runs the <code>main</code> program as the specified <code>fiber</code> and returns after <code>main</code> and all of the fibers spawned by <code>main</code> have returned.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span><span class="optlabel">?context</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?forbid</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>run main</code> is equivalent to calling <a href="#val-run_fiber"><code>run_fiber</code></a> with a freshly created fiber and <code>main</code> wrapped to capture the result of <code>main</code>.</p><p>The optional <code>forbid</code> argument defaults to <code>false</code> and determines whether propagation of cancelation is initially allowed.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_fiber_on"><a href="#val-run_fiber_on" class="anchor"></a><code><span><span class="keyword">val</span> run_fiber_on : 
  <span><span class="optlabel">?quota</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fatal_exn_handler</span>:<span>(<span>exn <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">n_domains</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../picos/Picos/Fiber/index.html#type-t">Picos.Fiber.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../../picos/Picos/Fiber/index.html#type-t">Picos.Fiber.t</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>run_fiber_on ~n_domains main</code> spawns <code>n_domains - 1</code> additional domains and runs the <code>main</code> on the current domain and those additional domains.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_on"><a href="#val-run_on" class="anchor"></a><code><span><span class="keyword">val</span> run_on : 
  <span><span class="optlabel">?quota</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fatal_exn_handler</span>:<span>(<span>exn <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">n_domains</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?forbid</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>run_on ~n_domains main</code> is equivalent to calling <a href="#val-run_fiber_on"><code>run_fiber_on</code></a> with a freshly created fiber and <code>main</code> wrapped to capture the result of <code>main</code>.</p><p>The optional <code>forbid</code> argument defaults to <code>false</code> and determines whether propagation of cancelation is initially allowed.</p></div></div></div></body></html>
