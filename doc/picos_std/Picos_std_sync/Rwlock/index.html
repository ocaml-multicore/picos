<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Rwlock (picos_std.Picos_std_sync.Rwlock)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.4"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../index.html">picos_std</a> &#x00BB; <a href="../index.html">Picos_std_sync</a> &#x00BB; Rwlock</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Picos_std_sync.Rwlock</span></code></h1><p>A poisonable, freezable, read-write lock.</p><p>üèéÔ∏è This uses a low overhead, optimistic, and unfair implementation that also does not perform runtime ownership error checking. In most cases this should be the read-write lock you will want to use and should give roughly equal or better performance than <a href="../Lock/index.html"><code>Lock</code></a> in cases where the majority of operations are reads.</p><p>üêå This is a &quot;slim&quot; lock. Acquiring the lock in read mode has low overhead, but limited scalability. For highly parallel use cases you will either want to use sharding or a &quot;fat&quot; scalable read-write lock.</p><p>‚ö†Ô∏è The current implementation allows readers to bypass the queue and does not prevent writers from starvation. For example, a pair of readers running concurrently, acquiring and releasing the lock such that there is never a point where the lock is fully released, prevents writers from acquiring the lock. This might be changed in the future such that neither readers nor writers should starve assuming no single party holds the lock indefinitely.</p><p>See also <a href="../Lock/index.html"><code>Lock</code></a>, and <a href="../Mutex/index.html"><code>Mutex</code></a>.</p></header><nav class="odoc-toc"><ul><li><a href="#basic-api">Basic API</a></li><li><a href="#state-query-api">State query API</a></li><li><a href="#expert-api">Expert API</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Represents a read-write lock.</p></div></div><h2 id="basic-api"><a href="#basic-api" class="anchor"></a>Basic API</h2><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><span class="optlabel">?padded</span>:bool <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create ()</code> returns a new read-write lock that is initially unlocked.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Poisoned"><a href="#exception-Poisoned" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Poisoned</span></span></code></div><div class="spec-doc"><p>Exception raised in case the read-write lock has been <a href="#val-poison" title="poison">poisoned</a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sharing"><a href="#val-sharing" class="anchor"></a><code><span><span class="keyword">val</span> sharing : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>sharing rwlock thunk</code> acquires a shared hold on the <code>rwlock</code> and calls <code>thunk ()</code>. Whether <code>thunk ()</code> returns a value or raises an exception, the shared hold on the <code>rwlock</code> will be released.</p><p>A single fiber may acquire a shared hold on a specific <code>rwlock</code> multiple times and other fibers may concurrently acquire shared holds on the <code>rwlock</code> as well.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Poisoned"><code>Poisoned</code></a> <p>in case the <code>rwlock</code> has been <a href="#val-poison" title="poison">poisoned</a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Frozen"><a href="#exception-Frozen" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Frozen</span></span></code></div><div class="spec-doc"><p>Exception raised in case the read-write lock has been <a href="#val-freeze" title="freeze">frozen</a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-holding"><a href="#val-holding" class="anchor"></a><code><span><span class="keyword">val</span> holding : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>holding rwlock thunk</code> acquires an exclusive hold on the <code>rwlock</code> and calls <code>thunk ()</code>. In case <code>thunk ()</code> returns a value, the read-write lock is released and the value is returned. Otherwise the read-write lock will be <a href="#val-poison" title="poison">poisoned</a> and the exception reraised.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Poisoned"><code>Poisoned</code></a> <p>in case the <code>rwlock</code> has been <a href="#val-poison" title="poison">poisoned</a>.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Frozen"><code>Frozen</code></a> <p>in case the <code>rwlock</code> has been <a href="#val-freeze" title="freeze">frozen</a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-freeze"><a href="#val-freeze" class="anchor"></a><code><span><span class="keyword">val</span> freeze : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>freeze rwlock</code> marks a <code>rwlock</code> as frozen, which means that one can no longer acquire an exclusive hold on the <code>rwlock</code>.</p><p>‚ÑπÔ∏è No exclusive hold can be obtained on a frozen lock.</p><p>üêå Freezing a <code>rwlock</code> does not improve the scalability of acquiring shared hold on the <code>rwlock</code>.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Poisoned"><code>Poisoned</code></a> <p>in case the <code>rwlock</code> has been <a href="#val-poison" title="poison">poisoned</a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-protect"><a href="#val-protect" class="anchor"></a><code><span><span class="keyword">val</span> protect : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>protect rwlock thunk</code> acquires an exclusive hold on the <code>rwlock</code>, runs <code>thunk ()</code>, and releases the <code>rwlock</code> after <code>thunk ()</code> returns or raises.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Poisoned"><code>Poisoned</code></a> <p>in case the lock has been <a href="#val-poison" title="poison">poisoned</a>.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Frozen"><code>Frozen</code></a> <p>in case the <code>rwlock</code> has been <a href="#val-freeze" title="freeze">frozen</a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Condition"><a href="#module-Condition" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Condition/index.html">Condition</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>A condition variable.</p></div></div><h2 id="state-query-api"><a href="#state-query-api" class="anchor"></a>State query API</h2><div class="odoc-spec"><div class="spec value anchored" id="val-is_locked_shared"><a href="#val-is_locked_shared" class="anchor"></a><code><span><span class="keyword">val</span> is_locked_shared : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_locked_shared rwlock</code> determines whether the <code>rwlock</code> is currently held shared or not.</p><p>‚ö†Ô∏è <code>is_locked_shared rwlock</code> will return <code>false</code> in case the <code>rwlock</code> is held exclusively.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_frozen"><a href="#val-is_frozen" class="anchor"></a><code><span><span class="keyword">val</span> is_frozen : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_frozen rwlock</code> determines whether the <code>rwlock</code> has been <a href="#val-freeze" title="freeze">frozen</a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_locked"><a href="#val-is_locked" class="anchor"></a><code><span><span class="keyword">val</span> is_locked : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_locked rwlock</code> determines whether the <code>rwlock</code> is currently held exclusively or not.</p><p>‚ö†Ô∏è <code>is_locked rwlock</code> will return <code>false</code> in case the <code>rwlock</code> is held shared.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_poisoned"><a href="#val-is_poisoned" class="anchor"></a><code><span><span class="keyword">val</span> is_poisoned : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_poisoned rwlock</code> determines whether the <code>rwlock</code> has been <a href="#val-poison" title="poison">poisoned</a>.</p></div></div><h2 id="expert-api"><a href="#expert-api" class="anchor"></a>Expert API</h2><p>‚ö†Ô∏è The calls in this section must be matched correctly or the state of the read-write lock may become corrupted.</p><div class="odoc-spec"><div class="spec value anchored" id="val-acquire_shared"><a href="#val-acquire_shared" class="anchor"></a><code><span><span class="keyword">val</span> acquire_shared : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>acquire_shared rwlock</code> acquires a shared hold on the <code>rwlock</code>.</p><p>A single fiber may acquire a shared hold on a specific <code>rwlock</code> multiple times and other fibers may concurrently acquire shared holds on the <code>rwlock</code> as well.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Poisoned"><code>Poisoned</code></a> <p>in case the <code>rwlock</code> has been <a href="#val-poison" title="poison">poisoned</a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-try_acquire_shared"><a href="#val-try_acquire_shared" class="anchor"></a><code><span><span class="keyword">val</span> try_acquire_shared : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>try_acquire_shared rwlock</code> attempts to acquire a shared hold on the <code>rwlock</code>. Returns <code>true</code> in case of success and <code>false</code> in case of failure.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Poisoned"><code>Poisoned</code></a> <p>in case the <code>rwlock</code> has been <a href="#val-poison" title="poison">poisoned</a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-release_shared"><a href="#val-release_shared" class="anchor"></a><code><span><span class="keyword">val</span> release_shared : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>release_shared rwlock</code> releases one shared hold on the <code>rwlock</code> or does nothing in case the <code>rwlock</code> has been <a href="#val-poison" title="poison">poisoned</a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-acquire"><a href="#val-acquire" class="anchor"></a><code><span><span class="keyword">val</span> acquire : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>acquire rwlock</code> acquires an exclusive hold on the <code>rwlock</code>.</p><p>A fiber may acquire an exclusive hold on a specific <code>rwlock</code> once at a time.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Poisoned"><code>Poisoned</code></a> <p>in case the <code>rwlock</code> has been <a href="#val-poison" title="poison">poisoned</a>.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Frozen"><code>Frozen</code></a> <p>in case the <code>rwlock</code> has been <a href="#val-freeze" title="freeze">frozen</a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-try_acquire"><a href="#val-try_acquire" class="anchor"></a><code><span><span class="keyword">val</span> try_acquire : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>try_acquire rwlock</code> attempts to acquire an exclusive hold on the <code>rwlock</code>. Returns <code>true</code> in case of success and <code>false</code> in case of failure.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Poisoned"><code>Poisoned</code></a> <p>in case the <code>rwlock</code> has been <a href="#val-poison" title="poison">poisoned</a>.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Frozen"><code>Frozen</code></a> <p>in case the <code>rwlock</code> has been <a href="#val-freeze" title="freeze">frozen</a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-release"><a href="#val-release" class="anchor"></a><code><span><span class="keyword">val</span> release : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>release rwlock</code> releases the exclusive hold on the <code>rwlock</code> or does nothing in case the <code>rwlock</code> has been <a href="#val-freeze" title="freeze">frozen</a> or <a href="#val-poison" title="poison">poisoned</a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-poison"><a href="#val-poison" class="anchor"></a><code><span><span class="keyword">val</span> poison : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>poison rwlock</code> marks an exclusively held <code>rwlock</code> as poisoned.</p><p>‚ÑπÔ∏è Neither shared nor exclusive hold can be obtained on a poisoned lock.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>in case the <code>rwlock</code> is not currently write locked.</p></li></ul></div></div></div></body></html>
