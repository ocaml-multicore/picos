<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (picos_aux.Picos_aux_rc.Make)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">picos_aux</a> &#x00BB; <a href="../index.html">Picos_aux_rc</a> &#x00BB; Make</nav><header class="odoc-preamble"><h1>Module <code><span>Picos_aux_rc.Make</span></code></h1><p>Creates a new external reference counting table for a resource type.</p><p>An externally reference counted resource.</p><p>ℹ️ This is intended for cases where a resource needs to be safely shared between multiple independent threads of control whether they are fibers, threads, or domains. In that use case you typically need to <a href="#val-incr" title="incr">increment</a> the reference count before handing the resource from one independent thread of control to another and the other independent thread of control then becomes responsible for <a href="#val-decr" title="decr">decrementing</a> the reference count after being done with the resource.</p></header><nav class="odoc-toc"><ul><li><a href="#parameters">Parameters</a></li><li><a href="#signature">Signature</a></li></ul></nav><div class="odoc-content"><h2 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h2><div class="odoc-spec"><div class="spec parameter anchored" id="argument-1-Resource"><a href="#argument-1-Resource" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-1-Resource/index.html">Resource</a></span><span> : <a href="../module-type-Resource/index.html">Resource</a></span></code></div></div><h2 id="signature"><a href="#signature" class="anchor"></a>Signature</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Resource"><a href="#module-Resource" class="anchor"></a><code><span><span class="keyword">module</span> Resource</span><span> = <a href="argument-1-Resource/index.html">Resource</a></span></code></div><div class="spec-doc"><p>Resource type.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Opaque type alias for the resource type.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><span class="optlabel">?dispose</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="argument-1-Resource/index.html#type-t">Resource.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create resource</code> adds an entry for the resource with an initial reference count of <code>1</code> to the table for the resource and returns the resource as a value of the <a href="#type-t" title="t">opaque alias type</a>.</p><p>The optional <code>dispose</code> argument defaults to <code>true</code>. When explicitly specified as <code>~dispose:false</code>, the resource will not be <a href="argument-1-Resource/index.html#val-dispose" title="Resource.dispose">disposed</a> when the reference count becomes zero. This is intended for special cases where a resource is e.g. managed outside of the control of the user program.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unsafe_get"><a href="#val-unsafe_get" class="anchor"></a><code><span><span class="keyword">val</span> unsafe_get : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="argument-1-Resource/index.html#type-t">Resource.t</a></span></code></div><div class="spec-doc"><p><code>unsafe_get opaque_resource</code> casts the opaque alias type back to the resource type.</p><p>⚠️ This should only be called and the resource used either after <a href="#val-create" title="create">creating</a> the reference counting entry or after <a href="#val-incr" title="incr">incrementing</a> the reference count and before the matching <a href="#val-decr" title="decr">decrement</a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-incr"><a href="#val-incr" class="anchor"></a><code><span><span class="keyword">val</span> incr : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>incr opaque_resource</code> tries to find the entry for the resource and increment the reference count.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>in case no entry is found for the resource or the reference count was zero or the resource was marked as closed previously by a <a href="#val-decr" title="decr">decrement</a> operation.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-decr"><a href="#val-decr" class="anchor"></a><code><span><span class="keyword">val</span> decr : <span><span class="optlabel">?close</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>decr opaque_resource</code> tries to find the entry for the resource and decrement the reference count. If the reference count becomes zero, the entry for the resource will be removed and the resource will be <a href="argument-1-Resource/index.html#val-dispose" title="Resource.dispose">disposed</a>, unless <code>~dispose:false</code> was specified for <a href="#val-create"><code>create</code></a>.</p><p>The optional <code>close</code> argument defaults to <code>false</code>. When explicitly specified as <code>~close:true</code> the resource will be marked as closed and attempts to <a href="#val-incr" title="incr">increment</a> the reference will fail.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>in case no entry is found for the resource or the reference count was zero.</p></li></ul></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-info"><a href="#type-info" class="anchor"></a><code><span><span class="keyword">type</span> info</span><span> = </span><span>{</span></code><ol><li id="type-info.resource" class="def record field anchored"><a href="#type-info.resource" class="anchor"></a><code><span>resource : <a href="argument-1-Resource/index.html#type-t">Resource.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The resource.</p><span class="comment-delim">*)</span></div></li><li id="type-info.count" class="def record field anchored"><a href="#type-info.count" class="anchor"></a><code><span>count : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Reference count. This may be <code>0</code>.</p><span class="comment-delim">*)</span></div></li><li id="type-info.closed" class="def record field anchored"><a href="#type-info.closed" class="anchor"></a><code><span>closed : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Whether the resource has been closed, see <a href="#val-decr"><code>decr</code></a>.</p><span class="comment-delim">*)</span></div></li><li id="type-info.dispose" class="def record field anchored"><a href="#type-info.dispose" class="anchor"></a><code><span>dispose : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Whether to dispose the resource, see <a href="#val-create"><code>create</code></a>.</p><span class="comment-delim">*)</span></div></li><li id="type-info.bt" class="def record field anchored"><a href="#type-info.bt" class="anchor"></a><code><span>bt : <span class="xref-unresolved">Stdlib</span>.Printexc.raw_backtrace;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Backtrace captured at <a href="#val-create"><code>create</code></a>.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Information on a resource.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-infos"><a href="#val-infos" class="anchor"></a><code><span><span class="keyword">val</span> infos : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-info">info</a> <span class="xref-unresolved">Stdlib</span>.Seq.t</span></span></code></div><div class="spec-doc"><p><code>infos ()</code> returns a sequence of entries in the reference counting table at the point in time of of calling <code>infos ()</code>.</p></div></div></div></body></html>
