<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>FLS (picos.Picos.Fiber.FLS)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../../';
let search_urls = ['../../../db.js','../../../../sherlodoc.js'];
</script><script src="../../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../../index.html">picos</a> &#x00BB; <a href="../../index.html">Picos</a> &#x00BB; <a href="../index.html">Fiber</a> &#x00BB; FLS</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Fiber.FLS</span></code></h1><p>Fiber local storage</p><p>Fiber local storage is intended for use as a low overhead storage mechanism for fiber extensions. For example, one might associate a priority value with each fiber for a scheduler that uses a priority queue or one might use FLS to store unique id values for fibers.</p><p>Here is an example of how one might define a fiber id:</p><pre class="language-ocaml"><code>let fiber_id_key =
  let next = Atomic.make 0 in
  let key =
    Fiber.FLS.new_key
    @@ Computed (fun () -&gt;
        Atomic.fetch_and_add next 1)
  in
  (key :&gt; _ Fiber.FLS.as_read_only)</code></pre><p>Here is an example of how one might define a fiber priority:</p><pre class="language-ocaml"><code>let fiber_priority_key =
  Fiber.FLS.new_key (Constant 0)</code></pre><p>A priority based scheduler could then use <a href="#val-get"><code>get</code></a> to access the priority of a fiber highly efficiently. Fibers that are fine with the default priority do not necessarily need to store a priority at all.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-key"><a href="#type-key" class="anchor"></a><code><span><span class="keyword">type</span> <span>(!'a, -'allowed) key</span></span></code></div><div class="spec-doc"><p>Represents a key for storing values of type <code>'a</code> in storage associated with fibers.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-as_read_only"><a href="#type-as_read_only" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a as_read_only</span></span><span> = <span><span>(<span class="type-var">'a</span>, <span>[ `Get ]</span>)</span> <a href="#type-key">key</a></span></span></code></div><div class="spec-doc"><p>Synonym for a key with allowed operations restricted to reading.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-initial"><a href="#type-initial" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a initial</span></span><span> = </span></code><ol><li id="type-initial.Constant" class="def variant constructor anchored"><a href="#type-initial.Constant" class="anchor"></a><code><span>| </span><span><span class="constructor">Constant</span> <span class="keyword">of</span> <span class="type-var">'a</span></span></code></li><li id="type-initial.Computed" class="def variant constructor anchored"><a href="#type-initial.Computed" class="anchor"></a><code><span>| </span><span><span class="constructor">Computed</span> <span class="keyword">of</span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></li></ol></div><div class="spec-doc"><p>Type to specify initial values for fibers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-new_key"><a href="#val-new_key" class="anchor"></a><code><span><span class="keyword">val</span> new_key : <span><span><span class="type-var">'a</span> <a href="#type-initial">initial</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span>[ `Get <span>| `Set</span> ]</span>)</span> <a href="#type-key">key</a></span></span></code></div><div class="spec-doc"><p><code>new_key initial</code> allocates a new key for associating values in storage associated with fibers. The <code>initial</code> value for every fiber is either the given <a href="#type-initial.Constant"><code>Constant</code></a> or is <a href="#type-initial.Computed"><code>Computed</code></a> with the given function. If the initial value is a constant, no value needs to be stored unless the value is explicitly updated.</p><p>‚ö†Ô∏è New keys should not be created dynamically.</p></div></div><p>‚ö†Ô∏è Operations that require the fiber handle to be <code>[&gt; `Sync]</code> can only be called safely from the fiber itself.</p><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span><span><span>[&gt; `Sync ]</span> <a href="../index.html#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span>[&gt; `Get ]</span>)</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>get fiber key</code> returns the value associated with the <code>key</code> in the storage associated with the <code>fiber</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set"><a href="#val-set" class="anchor"></a><code><span><span class="keyword">val</span> set : <span><span><span>[&gt; `Sync ]</span> <a href="../index.html#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span>[&gt; `Set ]</span>)</span> <a href="#type-key">key</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set fiber key value</code> sets the <code>value</code> associated with the <code>key</code> to the given value in the storage associated with the <code>fiber</code>.</p></div></div></div></body></html>
